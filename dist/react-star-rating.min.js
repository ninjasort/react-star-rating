"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _extends=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},_createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var r=e[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,a,r){return a&&t(e.prototype,a),r&&t(e,r),e}}(),_get=function(t,e,a){for(var r=!0;r;){var i=t,n=e,s=a;o=u=l=void 0,r=!1,null===i&&(i=Function.prototype);var o=Object.getOwnPropertyDescriptor(i,n);if(void 0!==o){if("value"in o)return o.value;var l=o.get;return void 0===l?void 0:l.call(s)}var u=Object.getPrototypeOf(i);if(null===u)return void 0;t=u,e=n,a=s,r=!0}},_react=require("react"),_react2=_interopRequireDefault(_react),_reactDom=require("react-dom"),_reactDom2=_interopRequireDefault(_reactDom),_classnames=require("classnames"),_classnames2=_interopRequireDefault(_classnames),StarRating=function(t){function e(t){_classCallCheck(this,e),_get(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.state={ratingCache:{pos:0,rating:0},editing:t.editing||!0,stars:5,rating:0,pos:0,glyph:this.getStars()}}return _inherits(e,t),_createClass(e,null,[{key:"propTypes",value:{name:_react2["default"].PropTypes.string.isRequired,caption:_react2["default"].PropTypes.string,totalStars:_react2["default"].PropTypes.number.isRequired,rating:_react2["default"].PropTypes.number,onRatingClick:_react2["default"].PropTypes.func,disabled:_react2["default"].PropTypes.bool,editing:_react2["default"].PropTypes.bool,size:_react2["default"].PropTypes.string},enumerable:!0},{key:"defaultProps",value:{step:.5,totalStars:5,onRatingClick:function(){},disabled:!1},enumerable:!0}]),_createClass(e,[{key:"componentWillMount",value:function(){if(this.min=0,this.max=this.props.totalStars||5,this.props.rating){this.state.editing=this.props.editing||!1;var t=this.props.rating;this.state.ratingCache.pos=this.getStarRatingPosition(t),this.setState({ratingCache:this.state.ratingCache,rating:t,pos:this.getStarRatingPosition(t)})}}},{key:"componentDidMount",value:function(){this.root=_reactDom2["default"].findDOMNode(this.refs.root),this.ratingContainer=_reactDom2["default"].findDOMNode(this.refs.ratingContainer)}},{key:"componentWillUnmount",value:function(){delete this.root,delete this.ratingContainer}},{key:"getStars",value:function(){for(var t="",e=this.props.totalStars,a=0;e>a;a++)t+="â˜…";return t}},{key:"getPosition",value:function(t){return t.clientX-this.root.getBoundingClientRect().left}},{key:"getWidthFromValue",value:function(t){var e=this.min,a=this.max;return e>=t||e===a?0:t>=a?100:100*(t-e)/(a-e)}},{key:"applyPrecision",value:function(t,e){return parseFloat(t.toFixed(e))}},{key:"getDecimalPlaces",value:function(t){var e=(""+t).match(/(?:\.(\d+))?(?:[eE]([+-]?\d+))?$/);return e?Math.max(0,(e[1]?e[1].length:0)-(e[2]?+e[2]:0)):0}},{key:"getValueFromPosition",value:function(t){var e=this.getDecimalPlaces(this.props.step),a=this.ratingContainer.offsetWidth,r=this.max-this.min,i=r*t/(a*this.props.step);i=Math.ceil(i);var n=this.applyPrecision(parseFloat(this.min+i*this.props.step),e);return n=Math.max(Math.min(n,this.max),this.min)}},{key:"calculate",value:function(t){var e=this.getValueFromPosition(t),a=this.getWidthFromValue(e);return a+="%",{width:a,val:e}}},{key:"getStarRatingPosition",value:function(t){var e=this.getWidthFromValue(t)+"%";return e}},{key:"getRatingEvent",value:function(t){var e=this.getPosition(t);return this.calculate(e)}},{key:"getSvg",value:function(t){for(var e=[],a=0;a<this.props.totalStars;a++){var r={};r.transform="translate("+50*a+", 0)",e.push(_react2["default"].createElement("path",_extends({key:"star-"+a},r,{d:"m0,18.1l19.1,0l5.9,-18.1l5.9,18.1l19.1,0l-15.4,11.2l5.9,18.1l-15.4,-11.2l-15.4,11.2l5.9,-18.1l-15.4,-11.2l0,0z"})))}var i={width:50*e.length+"px",height:"50px"};return _react2["default"].createElement("svg",{className:"rsr__star",style:i,viewBox:"0 0 "+e.length+" 50",preserveAspectRatio:"xMinYMin meet",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},_react2["default"].createElement("g",null,e.map(function(t){return t})))}},{key:"updateRating",value:function(t,e){this.setState({pos:t,rating:e})}},{key:"shouldComponentUpdate",value:function(t,e){return t!==this.props?(this.updateRating(this.getStarRatingPosition(t.rating),t.rating),!0):e.ratingCache.rating!==this.state.ratingCache.rating||e.rating!==this.state.rating}},{key:"handleMouseLeave",value:function(){this.setState({pos:this.state.ratingCache.pos,rating:this.state.ratingCache.rating})}},{key:"handleMouseMove",value:function(t){var e=this.getRatingEvent(t);this.updateRating(e.width,e.val)}},{key:"handleClick",value:function(t){if(this.props.disabled)return t.stopPropagation(),t.preventDefault(),!1;var e={pos:this.state.pos,rating:this.state.rating,caption:this.props.caption,name:this.props.name};this.setState({ratingCache:e}),this.props.onRatingClick(t,e)}},{key:"treatName",value:function(t){return"string"==typeof t?t.toLowerCase().split(" ").join("_"):void 0}},{key:"render",value:function(){var t,e=null,a=(0,_classnames2["default"])((t={"rsr-root":!0,"rsr--disabled":this.props.disabled},_defineProperty(t,"rsr--"+this.props.size,this.props.size),_defineProperty(t,"rsr--editing",this.state.editing),t));this.props.caption&&(e=_react2["default"].createElement("span",{className:"rsr__caption"},this.props.caption));var r={};return this.state.editing&&(r.onMouseMove=this.handleMouseMove.bind(this),r.onMouseLeave=this.handleMouseLeave.bind(this),r.onClick=this.handleClick.bind(this)),_react2["default"].createElement("span",{className:"rsr-container"},e,_react2["default"].createElement("div",{ref:"root",className:a},_react2["default"].createElement("div",_extends({ref:"ratingContainer",className:"rsr rating-gly-star","data-content":this.state.glyph},r),this.getSvg(this.state.rating))))}}]),e}(_react2["default"].Component);exports["default"]=StarRating,module.exports=exports["default"];